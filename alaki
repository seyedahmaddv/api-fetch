<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .user-card {
            cursor: pointer;
        }
        .card-img-top {
            width: 100%;
            height: 15vw;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-4">User List</h1>
        <div class="row" id="user-list">
            <!-- User cards will be inserted here -->
        </div>
        <button class="btn btn-primary mt-4" data-toggle="modal" data-target="#addUserModal">Add User</button>
    </div>

    <!-- User Modal -->
    <div class="modal fade" id="userModal" tabindex="-1" role="dialog" aria-labelledby="userModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="userModalLabel">User Details</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <img id="modal-avatar" src="" alt="User Avatar" class="img-fluid mb-3">
                    <h4 id="modal-name"></h4>
                    <p id="modal-email"></p>
                    <button class="btn btn-primary" id="edit-user-btn">Edit User</button>
                    
                    <!-- Edit User Form -->
                    <form id="edit-user-form" class="mt-3" style="display: none;">
                        <div class="form-group">
                            <label for="edit-first-name">First Name</label>
                            <input type="text" class="form-control" id="edit-first-name" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-last-name">Last Name</label>
                            <input type="text" class="form-control" id="edit-last-name" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-email">Email</label>
                            <input type="email" class="form-control" id="edit-email" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-avatar-url">Avatar URL</label>
                            <input type="url" class="form-control" id="edit-avatar-url" required>
                        </div>
                        <button type="submit" class="btn btn-success">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Add User Modal -->
    <div class="modal fade" id="addUserModal" tabindex="-1" role="dialog" aria-labelledby="addUserModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addUserModalLabel">Add New User</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="add-user-form">
                        <div class="form-group">
                            <label for="first-name">First Name</label>
                            <input type="text" class="form-control" id="first-name" required>
                        </div>
                        <div class="form-group">
                            <label for="last-name">Last Name</label>
                            <input type="text" class="form-control" id="last-name" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="avatar-url">Avatar URL</label>
                            <input type="url" class="form-control" id="avatar-url" required>
                        </div>
                        <button type="submit" class="btn btn-success">Add User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS, Popper.js, and Vanilla JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let currentUserId = null;

            // Fetch users from the API
            fetch('https://reqres.in/api/users')
                .then(response => response.json())
                .then(data => {
                    const users = data.data;
                    const userList = document.getElementById('user-list');

                    users.forEach(user => {
                        const userCard = document.createElement('div');
                        userCard.className = 'col-md-4 mb-4';

                        userCard.innerHTML = `
                            <div class="card user-card" data-id="${user.id}">
                                <img src="${user.avatar}" class="card-img-top" alt="${user.first_name} ${user.last_name}">
                                <div class="card-body">
                                    <h5 class="card-title">${user.first_name} ${user.last_name}</h5>
                                    <p class="card-text">${user.email}</p>
                                </div>
                            </div>
                        `;

                        userList.appendChild(userCard);

                        // Add click event to open user details in a modal
                        userCard.querySelector('.user-card').addEventListener('click', () => {
                            currentUserId = user.id;
                            document.getElementById('modal-avatar').src = user.avatar;
                            document.getElementById('modal-name').textContent = `${user.first_name} ${user.last_name}`;
                            document.getElementById('modal-email').textContent = user.email;

                            // Pre-fill the edit form with user data
                            document.getElementById('edit-first-name').value = user.first_name;
                            document.getElementById('edit-last-name').value = user.last_name;
                            document.getElementById('edit-email').value = user.email;
                            document.getElementById('edit-avatar-url').value = user.avatar;

                            document.getElementById('edit-user-form').style.display = 'none';
                            document.getElementById('edit-user-btn').style.display = 'block';
                            $('#userModal').modal('show');
                        });
                    });
                });

            // Show edit form on "Edit User" button click
            document.getElementById('edit-user-btn').addEventListener('click', () => {
                document.getElementById('edit-user-btn').style.display = 'none';
                document.getElementById('edit-user-form').style.display = 'block';
            });

            // Handle edit form submission
            document.getElementById('edit-user-form').addEventListener('submit', (event) => {
                event.preventDefault();
                const updatedUser = {
                    first_name: document.getElementById('edit-first-name').value,
                    last_name: document.getElementById('edit-last-name').value,
                    email: document.getElementById('edit-email').value,
                    avatar: document.getElementById('edit-avatar-url').value
                };

                // Send PUT request to update the user (mock)
                fetch(`https://reqres.in/api/users/${currentUserId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updatedUser)
                })
                .then(response => response.json())
                .then(data => {
                    alert('User updated successfully!');
                    $('#userModal').modal('hide');
                })
                .catch(error => {
                    console.error('Error updating user:', error);
                });
            });

            // Add new user
            document.getElementById('add-user-form').addEventListener('submit', (event) => {
                event.preventDefault();
                const newUser = {
                    first_name: document.getElementById('first-name').value,
                    last_name: document.getElementById('last-name').value,
                    email: document.getElementById('email').value,
                    avatar: document.getElementById('avatar-url').value
                };

                // Send POST request to add new user (Note: reqres.in won't actually add a user, it's for testing only)
                fetch('https://reqres.in/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newUser)
                })
                .then(response => response.json())
                .then(data => {
                    alert('User added successfully!');
                    $('#addUserModal').modal('hide');
                })
                .catch(error => {
                    console.error('Error adding user:', error);
                });
            });
        });
    </script>
</body>
</html>
